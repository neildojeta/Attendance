{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="{% static 'myapp/student.css' %}">  
</head>
<body>
    <!-- Sidebar -->
    <header id="header">
        <div class="logo-container">
            <img src="{% static 'myapp/college.png' %}" alt="CSA Logo">
        </div>

        <div class="redcontainer">
            <h1>Welcome, Student</h1>

            <!-- Navigation -->
            <nav class="nav">
                <a href="?tab=students" class="nav-link">Students</a>
                <a href="?tab=events" class="nav-link">Events</a>
            </nav>

            <!-- Logout Button -->
            <form method="post" action="{% url 'logout' %}" class="logout-form">
                {% csrf_token %}
                <button type="submit" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </form>
        </div>
    </header>

    <!-- Dashboard Content -->
    <div class="dashboard-container">
        <div class="user-icon">
            <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="User Icon">
        </div>
        <h1>Student Dashboard</h1>

        <div class="dashboard-layout">
            <!-- Student Info -->
            <div class="info-card">
                <div class="info-row"><strong>Student ID:</strong> 202312345</div>
                <div class="info-row"><strong>Name:</strong> Bentong Kabayo</div>
                <div class="info-row"><strong>Year Level:</strong> 2nd Year</div>
                <div class="info-row"><strong>Course:</strong> BS Information Technology</div>
                <div class="info-row"><strong>Sex:</strong> Male</div>
            </div>

            <!-- Calendar Section -->
            <div class="calendar-section">
                <label><strong>Todayâ€™s Date:</strong></label>
                <div id="calendar"></div>

                <input type="hidden" id="event-date" readonly>

                <div class="button-group">
                    <button class="attend-btn" onclick="markAttendance()">Attend</button>
                    <button class="timeout-btn" onclick="markTimeout()">Time Out</button>
                </div>

                <div class="timestamp" id="timestamp">
                    <div id="timeInSection"></div>
                    <div id="timeOutSection"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        const today = new Date().toISOString().split('T')[0];

        flatpickr("#calendar", {
            inline: true,
            defaultDate: today,
            enable: [today],
            showMonths: 1,
            disableMobile: true,
            onReady: function(selectedDates, dateStr, instance) {
                document.getElementById("event-date").value = dateStr;
            }
        });

        window.onload = function () {
            const timeoutBtn = document.querySelector('.timeout-btn');
            timeoutBtn.disabled = true;
            timeoutBtn.style.opacity = "0.6";
            timeoutBtn.style.cursor = "not-allowed";
        };

        function isWithinAllowedHours() {
            const now = new Date();
            const hours = now.getHours();
            return hours >= 7 && hours < 23;
        }

        function markAttendance() {
            const attendBtn = document.querySelector('.attend-btn');
            const timeoutBtn = document.querySelector('.timeout-btn');

            if (attendBtn.disabled) return;

            if (!isWithinAllowedHours()) {
                alert("Attendance is only allowed from 7:00 AM to 11:00 PM.");
                return;
            }

            const selectedDate = document.getElementById("event-date").value;
            const now = new Date();
            const timeStamp = now.toLocaleString();

            if (selectedDate) {
                document.getElementById("timeInSection").innerHTML =
                    `<strong>Attendance Recorded:</strong><br>Event Date: ${selectedDate}<br>Time In: ${timeStamp}`;
                document.getElementById("timeOutSection").innerHTML = "";

                attendBtn.disabled = true;
                attendBtn.style.opacity = "0.6";
                attendBtn.style.cursor = "not-allowed";

                timeoutBtn.disabled = false;
                timeoutBtn.style.opacity = "1";
                timeoutBtn.style.cursor = "pointer";
            }
        }

        function markTimeout() {
            const timeoutBtn = document.querySelector('.timeout-btn');

            if (timeoutBtn.disabled) return;

            const selectedDate = document.getElementById("event-date").value;
            const now = new Date();
            const timeStamp = now.toLocaleString();

            if (selectedDate) {
                document.getElementById("timeOutSection").innerHTML =
                    `<strong>Time Out Recorded:</strong><br>Event Date: ${selectedDate}<br>Time Out: ${timeStamp}`;
                document.getElementById("timeInSection").innerHTML = "";

                timeoutBtn.disabled = true;
                timeoutBtn.style.opacity = "0.6";
                timeoutBtn.style.cursor = "not-allowed";
            }
        }
    </script>
</body>
</html>
